# **利用频率分析与遗传算法破解简单替换密码**

*编辑人：Coffee 编辑日期：2024年6月20日*  

---

## 一、实验目的

本实验旨在利用频率分析与遗传算法破解简单替换密码。  

简单替换密码：将26个英文字母打乱排序后一一替换原文本。如：  

a b c d e f g h i j k l m n o p q r s t u v w x y z  

q w e r t y u i o p a s d f g h j k l z x c v b n m  

（上面一行为原字母顺序，下面一行为打乱后顺序）  

该简单替换密码的密钥即打乱后字母的排列顺序。  

## 二、实验内容与步骤  

### 2.1 问题描述与分析  

目前，替换密码的主要破解方法有频率分析、字母组合分析、字典攻击等，其中频率分析是基于这样一个事实：每种自然语言都有一些字母或字母组合出现的频率比其他字母或字母组合高。频率分析通过分析加密文本中各个符号出现的频率，并将其与已知语言的频率分布进行比较，可以猜测出一些字母的替换。然而，频率分析要求有大量的密文样本并且在区分频率相近的字母时准确度较低，后期需要大量人力校验。  

为了解决频率分析的这些问题，我将频率分析与遗传算法结合使用。遗传算法（Genetic Algorithm，GA）是一种启发式搜索算法，灵感来源于生物进化过程。遗传算法在解决优化问题，包括密码破解方面，可以提供一种有效的手段。对于破解替换密码，遗传算法的主要帮助在于提供一种高效搜索解空间的方法，从而找到可能的密钥。  

在使用遗传算法破解简单替换密码的过程中，我将定义以下几个关键点：  

- **个体**：即一组密钥以及其对应的适应度。  

- **染色体**：一个个体的染色体即该个体的密钥。  

- **适应度**：在文件夹中建立一个词典并存入常用的3000个单词，按照当前个体的密钥将密文解密后将密文中单词一一在词典中查询，将查询成功的单词数与查询的单词总数的比值作为该个体的适应度。  

- **种群**：由同一代个体所组成的集合。  

- **交配**：从种群中选取两个个体作为父母，指定一个字母作为结点，取父亲个体结点前的一段染色体，与母亲个体结点后的一段染色体结合形成新的个体。  

- **变异**：在交配完成后，新个体有一定概率出现变异，即新个体的染色体上某随机位置的字母有一定概率与其后一位字母交换位置。  

使用遗传算法可以有效解决小样本情况下频率分析准确度较低以及在区分频率相近的字母时准确度较低的问题。然而，在实际使用遗传算法时会出现以下问题：  

1. 若变异过程中，发生变异的字母恰好位于结点位置，则会导致字母跨越结点交换，该个体再继续与其他个体交配时可能产生同一字母在染色体中出现两次的情况，进而破坏规则。因此必须规定结点处字母不能发生变异与结点另一边字母发生交换。  

2. 由1得，结点两侧字母断绝交换可能，若某一字母的正确位置恰好在结点另一侧则永远不可能恢复。  

 ![image-20240709121828213](C:\Users\coffee\AppData\Roaming\Typora\typora-user-images\image-20240709121828213.png)

为了解决以上两个问题，利用频率分析（图1）可知r与d的频率差距较为明显，通过较小规模的密文样本即可将r及之前的字母与d及之后的字母区分。因此，将r作为染色体中的结点。为了实现此算法，首先对密文进行频率分析得到“祖先”，由“祖先”变异得到第一个种群，然后开始遗传算法直到指定代数。每生成一代记录该代最佳个体并比较得到全局最佳个体，最后用全局最佳个体为密文解密。  

### 2.2 流程设计  

![image-20240709121113902](C:\Users\coffee\AppData\Roaming\Typora\typora-user-images\image-20240709121113902.png)

### 2.3 核心代码解读  

1. **数据结构定义**  

- Individual：表示遗传算法中的个体，包含染色体（字母映射）和适应度。  

- Population：表示遗传算法中的种群，包含个体数量和个体数组。  

- TrieNode：表示字典树结点，用于存储和查找单词。  

2. **初始化与基本操作**  

- createNewIndividual：创建一个新的个体，并将其适应度初始化为-1。  

- createAncestor：通过统计字符频率创建初始个体（祖先），用于种群的起始点。  

- DecodeForFitness：根据个体的染色体解密文本，并计算解密后的文本的单词数量，作为适应度计算的一部分。  

- createNode、insertWord、searchWord、freeTrie：这些函数用于创建、插入、搜索和释放字典树，帮助在适应度计算过程中快速查找单词。  

- load_words：从文件加载单词列表。  

3. **适应度计算**  

- Fitness：计算个体的适应度，通过解密文本并统计在词典中找到的单词数量来衡量解密结果的好坏。  

4. **遗传操作**  

- SmallRandomProbability：生成一个小概率事件，用于决定是否进行变异。  

- Mutate：变异操作，随机交换个体染色体中的两个字符。  

- Mating：交配操作，从父母个体生成子代个体，并可能进行变异。  

5. **种群操作**  

- createTheFirstGroup：创建初始种群，包括祖先和变异后的个体。  

- Random_Selection：随机选择个体进行繁殖，使用轮盘赌策略。  

- createAnewGroup：创建一个新的空种群。  

- freePopulation：释放种群占用的内存。  

- AddNewPopulation：向种群中添加新的个体。  

- ChooseBestIndividual：选择种群中适应度最高的个体。  

- Generate_next_generation：生成下一代种群，使用选择、交配和变异操作。  

6. **解密过程**  

- Decode：使用全局最佳个体的染色体解密密文，并输出解密结果。  

7. **主程序**  

- Genetic_Algorithm：遗传算法的主过程，初始化种群，并迭代生成新一代种群，直到达到预定的迭代次数。  

- main：程序入口，提供用户交互界面，调用遗传算法进行密码破解。  

## 三、用户使用说明  

1. 请将待解密的txt格式的文本命名为code.txt，将txt格式的样本文本数据命名为data.txt，并且都存放在exe文件同一目录下，解密后文本将被命名为decode.txt保存在同一目录下。  

2. 请确保样本文本足够大（至少3000个单词），样本文本数量越大结果可能越准确。  

3. 运行程序后，根据提示按下1开始解析密码，按下0退出程序。  

4. 程序会先进行密码解析，解析完成后会开始解密。  

5. 解密完成后，解密结果会保存在decode.txt文件中。  

6. 如果需要再次解密其他文本，请先按照步骤1重新命名文本文件，然后再次按下1开始解析密码。  

7. 程序会自动进行遗传算法的迭代过程，迭代次数由程序内部定义，用户无需干预。  

8. 解析过程中，程序会输出每一代的最佳个体适应度，用户可以根据适应度来判断解密效果。  

9. 解析过程中如果出现内存溢出等问题，程序会提示错误信息并退出。  

